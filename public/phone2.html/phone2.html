<!doctype html>
<html>
<head><meta charset="utf-8"><title>Phone2</title></head>
<body>
<h3>Phone-2 (callee)</h3>
<button id="enable">Enable microphone & ready</button>
<audio id="remote" autoplay></audio>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let pc, localStream;

document.getElementById('enable').onclick = async () => {
  localStream = await navigator.mediaDevices.getUserMedia({audio: true});
  document.getElementById('enable').disabled = true;
  console.log('Mic aktif, hazÄ±r.');
};

socket.on('offer', async (offer) => {
  if (!localStream) return;
  pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]});
  pc.ontrack = e => document.getElementById('remote').srcObject = e.streams[0];
  pc.onicecandidate = e => { if (e.candidate) socket.emit('ice', e.candidate); };
  localStream.getTracks().forEach(t => pc.addTrack(t, localStream));
  await pc.setRemoteDescription(offer);
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  socket.emit('answer', answer);
});

socket.on('ice', c => { if (pc) pc.addIceCandidate(c).catch(()=>{}); });
</script>
</body>
</html>
