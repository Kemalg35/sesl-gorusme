<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Phone 2</title>
</head>
<body>
  <h2>Phone 2</h2>
  <script>
    const socket = new WebSocket("wss://sesl-gorusme.onrender.com/ws");

    const peer = new RTCPeerConnection({
      iceServers: [
        { urls: "stun:stun.l.google.com:19302" },
        {
          urls: "turn:numb.viagenie.ca",
          username: "webrtc@live.com",
          credential: "muazkh"
        }
      ]
    });

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      stream.getTracks().forEach(track => peer.addTrack(track, stream));
    });

    peer.ontrack = (event) => {
      const audio = document.createElement("audio");
      audio.srcObject = event.streams[0];
      audio.autoplay = true;
      document.body.appendChild(audio);
    };

    socket.onmessage = async (event) => {
      const message = JSON.parse(event.data);
      if (message.offer) {
        await peer.setRemoteDescription(new RTCSessionDescription(message.offer));
        const answer = await peer.createAnswer();
        await peer.setLocalDescription(answer);
        socket.send(JSON.stringify({ answer }));
      }
      if (message.candidate) {
        await peer.addIceCandidate(new RTCIceCandidate(message.candidate));
      }
    };

    peer.onicecandidate = (event) => {
      if (event.candidate) {
        socket.send(JSON.stringify({ candidate: event.candidate }));
      }
    };
  </script>
</body>
</html>
